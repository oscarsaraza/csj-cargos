generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserRole {
  csj
  deaj
  office
  external
}

model User {
  id                          String                     @id @default(auto()) @map("_id") @db.ObjectId
  username                    String                     @unique
  password                    String
  passwordExpiresAt           DateTime
  sessions                    Session[]
  enlacesCsj                  EnlaceCsj[]
  enlacesDeaj                 EnlaceDeaj[]
  role                        UserRole                   @default(external)
  datosUdaeActoAdministrativo EnlaceActoAdministrativo[]
  datosValidacionCargo        DatosValidacionCargo[]
}

model Session {
  id        String   @id @default(cuid()) @map("_id")
  expiresAt DateTime
  userId    String   @db.ObjectId
  user      User     @relation(references: [id], fields: [userId], onDelete: Cascade)
  username  String
}

model DatosUdae {
  id                              String                    @id @default(auto()) @map("_id") @db.ObjectId
  actoAdministrativoModificatorio String?
  anioActoAdministrativo          Int?
  circuitoJudicial                String
  codigoInterno                   Int?
  consejoSeccional                String
  denominacionInicial             String?
  dependencia                     String
  descripcionCargo                String
  direccionSeccional              String
  distritoJudicial                String
  especialidad                    String
  gradoCargo                      String
  gradoInicial                    String?
  jurisdiccion                    String
  municipioSedeFisica             String
  nombreDespacho                  String
  numero                          Int
  numeroActoAdministrativo        String?
  observaciones                   String?
  subespecialidad                 String
  tipoActoAdministrativo          String?
  enlaceCsj                       EnlaceCsj?
  enlaceDeaj                      EnlaceDeaj?
  datosActoAdministrativo         EnlaceActoAdministrativo?
  datosEncuesta                   DatosEncuesta?
  datosValidacion                 DatosValidacionCargo?
}

model EnlaceCsj {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime  @default(now())
  userId      String    @db.ObjectId
  user        User      @relation(fields: [userId], references: [id])
  datosUdaeId String    @unique @db.ObjectId
  datosUdae   DatosUdae @relation(fields: [datosUdaeId], references: [id])
  datosCsjId  String    @unique @db.ObjectId
  datosCsj    DatosCsj  @relation(fields: [datosCsjId], references: [id])
}

model DatosCsj {
  id                String     @id @default(auto()) @map("_id") @db.ObjectId
  acuerdo           String?
  cargo             String
  cedula            String?
  circuito          String
  codigoDespacho    String
  condicionEspecial String
  depacho           String
  escalafon         String?
  estadoActual      String
  estadoVacante     String
  genero            String?
  municipio         String
  nivel             String?
  numero            String
  observaciones     String?
  propiedad         String?
  provisionalidad   String?
  tramitePendiente  String?
  enlace            EnlaceCsj?
}

model EnlaceDeaj {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime   @default(now())
  datosUdaeId String     @unique @db.ObjectId
  datosUdae   DatosUdae  @relation(fields: [datosUdaeId], references: [id])
  datosDeajId String?    @unique @db.ObjectId
  datosDeaj   DatosDeaj? @relation(fields: [datosDeajId], references: [id])
  userId      String     @db.ObjectId
  user        User       @relation(fields: [userId], references: [id])

  @@unique([datosUdaeId, datosDeajId])
}

model DatosDeaj {
  id                              String      @id @default(auto()) @map("_id") @db.ObjectId
  cargoProvisional                String?
  cargoTitular                    String
  ciudadUbicacionLaboral          String?
  claseNombramiento               String?
  codCargoProvisional             String?
  codCargoTitular                 String
  codDependenciaProvisional       String?
  codDependenciaTitular           String
  codigoUnidadEjecutora           String
  dependenciaProvisional          String?
  dependenciaTitular              String
  fechaContinuidad                String?
  fechaFin                        String?
  fechaIngresoSeccional           String?
  fechaInicial                    String?
  fechaInicio                     String?
  fechaRetiro                     String?
  fechaRetiroSeccional            String?
  idOcurrenciaTitular             String?
  naturaleza                      String?
  naturalezaOcurrenciaProvisional String?
  nomDocumentoReemplazo           String?
  nombreReemplazo                 String?
  nombreRef                       String?
  numDocumento                    String?
  numDocumentoRef                 String?
  numVinculacion                  String?
  numVinculacionReemplazo         String?
  ocurrenciaProvisional           String?
  refNumVinculacion               String?
  regimenSalarial                 String?
  registro                        String?
  servidor                        String
  unidadEjecutora                 String
  vinculacionNovedad              String?
  enlace                          EnlaceDeaj?
}

enum TipoActoAdministrativo {
  LEY
  DECRETO
  ACUERDO
  ACUERDO_SALA
}

model ActoAdministrativo {
  id                   String                     @id @default(auto()) @map("_id") @db.ObjectId
  tipo                 TipoActoAdministrativo
  anio                 String
  numero               String
  enlace               String                     @default("")
  enlacesUdae          EnlaceActoAdministrativo[]
  datosValidacionCargo DatosValidacionCargo[]

  @@unique([tipo, anio, numero])
}

model EnlaceActoAdministrativo {
  id                   String             @id @default(auto()) @map("_id") @db.ObjectId
  createdAt            DateTime           @default(now())
  userId               String             @db.ObjectId
  user                 User               @relation(fields: [userId], references: [id])
  datosUdaeId          String             @unique @db.ObjectId
  datosUdae            DatosUdae          @relation(fields: [datosUdaeId], references: [id])
  actoAdministrativoId String             @db.ObjectId
  actoAdministrativo   ActoAdministrativo @relation(fields: [actoAdministrativoId], references: [id])
  // Si cuando el tipo de acto, número y año coinciden con los datos de la UDAE, No en caso contrario
  actoCorrecto         String
  articulo             String
  literal              String?
  numeral              String?
  // Todas las profesiones que solicita el perfil del cargo del acto administrativo.
  perfilCargo          String
}

model DatosEncuesta {
  id                         String    @id @default(auto()) @map("_id") @db.ObjectId
  // Cédula de ciudadanía, Cédula de extranjería, Número Único de Identificación Personal (NUIP)
  tipoDocumento              String
  documento                  String
  nombres                    String
  apellidos                  String
  // Bachiller, Tecnólogo, Técnico, Profesional, Pos grado, Doctorado, Pos doctorado
  nivelEscolaridad           String
  // Número de familiares dependientes con los que convive (1er grado de consanguinidad/afinidad)
  familiaresDependientes     Int
  // profesion1 Debe ser una de las profesiones del perfil del cargo.
  // Si no coincide, permitir agregar pero dejar la observación.
  profesion1                 String    @default("")
  profesion2                 String    @default("")
  profesion3                 String    @default("")
  tieneServidorProv          String    @default("No") //Si, No
  tipoDocumentoProv          String    @default("")
  documentoProv              String    @default("")
  nombresProv                String    @default("")
  apellidosProv              String    @default("")
  nivelEscolaridadProv       String    @default("")
  familiaresDependientesProv Int       @default(0)
  datosUdaeId                String    @unique @db.ObjectId
  datosUdae                  DatosUdae @relation(fields: [datosUdaeId], references: [id])
}

model DatosValidacionCargo {
  id                            String             @id @default(auto()) @map("_id") @db.ObjectId
  datosUdaeId                   String             @unique @db.ObjectId
  datosUdae                     DatosUdae          @relation(fields: [datosUdaeId], references: [id])
  userId                        String             @db.ObjectId
  user                          User               @relation(fields: [userId], references: [id])
  observacionesDespacho         String             @default("") // Observaciones del nombre del despacho, cargo y grado
  observacionesClasificacion    String             @default("") // Obsevaciones de clasificacion, provisión del cargo y profesión
  cargoExiste                   String             @default("") // Si, No, Si con novedad de traslado o supresión (requerir observacionesNovedad)
  tipoNovedad                   String             @default("") // Traslado o supresión
  tipoTraslado                  String             @default("") // Transitorio o permanente
  jurisdiccionTraslado          String             @default("") // ADMINISTRATIVA, AGRARIO Y RURAL, CONTENCIOSO ADMINISTRATIVO, DISCIPLINARIA, ORDINARIA 
  distritoDestinoTraslado       String             @default("")
  circuitoDestinoTraslado       String             @default("")
  municipioDestinoTraslado      String             @default("")
  despachoDestinoTraslado       String             @default("")
  codigoDespachoDestinoTraslado String             @default("")
  actoAdministrativoId          String             @db.ObjectId
  actoAdministrativo            ActoAdministrativo @relation(fields: [actoAdministrativoId], references: [id])
  observacionesNovedad          String             @default("") // Observaciones de la novedad (traslado o supresión)
}
